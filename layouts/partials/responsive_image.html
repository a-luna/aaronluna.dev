{{ $postImage := .Page.Resources.GetMatch (printf "*main*") }}
{{ if $postImage }}
    {{ $tiny := $postImage.Resize "500x" }}
    {{ $small := $postImage.Resize "800x" }}
    {{ $medium := $postImage.Resize "1200x" }}
    {{ $large := $postImage.Resize "1500x" }}

    {{ if ge $postImage.Width "500" }}
        {{ .Scratch.Add "srcset" $tiny.RelPermalink }}
        {{ .Scratch.Add "srcset" " 500w" }}
    {{ end }}
    {{ if ge $postImage.Width "800" }}
        {{ .Scratch.Add "srcset" ", " }}
        {{ .Scratch.Add "srcset" $small.RelPermalink }}
        {{ .Scratch.Add "srcset" " 800w" }}
    {{ end }}
    {{ if ge $postImage.Width "1200" }}
        {{ .Scratch.Add "srcset" ", " }}
        {{ .Scratch.Add "srcset" $medium.RelPermalink }}
        {{ .Scratch.Add "srcset" " 1200w" }}
    {{ end }}
    {{ if ge $postImage.Width "1500" }}
        {{ .Scratch.Add "srcset" ", " }}
        {{ .Scratch.Add "srcset" $large.RelPermalink }}
        {{ .Scratch.Add "srcset" " 1500w" }}
    {{ end }}

    <figure>
        <img sizes="(min-width: 35em) 1200px, 100vw" srcset='{{ .Scratch.Get "srcset" }}' src="{{ $postImage.RelPermalink }}" alt="{{ .Page.Title }}">
        <figcaption><p>{{ $postImage.Params.credit }}</p></figcaption>
    </figure>
{{ end }}
