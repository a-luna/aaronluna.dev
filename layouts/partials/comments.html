{{ if and .Site.DisqusShortname (not (or .Site.Params.disable_comments .Params.disable_comments)) }}
<section class="comments">
    <div id="disqus-container">
        {{ with .Site.DisqusShortname }}
        <button id="disqus-button" onclick="showComments()">SHOW COMMENTS</button>
        <div id="disqus-comments">
            {{ $isDummyName := eq . "yourdiscussshortname" }} {{ $isServer := $.Site.IsServer }} {{ if or $isDummyName $isServer }}
            <p>Comments are disabled</p>
            <script type="application/javascript">
                function showComments() {
                    // Remove button
                    var disqusButton = document.getElementById('disqus-button');
                    disqusButton.parentNode.removeChild(disqusButton);
                    // Un-hide comments
                    var disqusComments = document.getElementById('disqus-comments');
                    disqusComments.style.display = 'block';
                }
            </script>
            {{ else }}
            <div id="disqus_thread">
            </div>
            <script type="application/javascript">
                function showComments() {
                    // Config
                    var disqus_config = function() {};
                    // Build and append comments 
                    var d = document;
                    var s = d.createElement('script');
                    s.async = true;
                    s.src = '//' + "{{ . }}" + '.disqus.com/embed.js';
                    s.setAttribute('data-timestamp', +new Date());
                    (d.head || d.body).appendChild(s);
                    // Remove button
                    var disqusButton = document.getElementById('disqus-button');
                    disqusButton.parentNode.removeChild(disqusButton);
                    // Un-hide comments
                    var disqusComments = document.getElementById('disqus-comments');
                    disqusComments.style.display = 'block';
                }
            </script>
            {{ end }}
            <noscript>Enable JavaScript to view Disqus comments.</noscript>
        </div>
        {{ end }}
    </div>
</section>
{{ end }}